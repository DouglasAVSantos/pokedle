<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pokedle - Adivinhe o Pokémon</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            background-image: url('https://r4.wallpaperflare.com/wallpaper/732/382/353/pokemon-first-generation-pokemon-wallpaper-22c162007d865e5bdad852a510281902.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;

            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 0;
            padding: 40px 20px;
            min-height: 100vh;
        }
        .main-container {
            background-color: rgba(255, 255, 255, 0.85);
            padding: 30px;
            border: 2px solid #333;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 900px;
            text-align: center;
            margin-bottom: 25px;
        }
        h1 {
            margin-bottom: 15px;
        }
        .pokedle-logo {
            width: 100%;
            max-width: 450px;
            height: auto;
        }
        .guess-form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 20px;
        }
        .guess-form .select2-container {
            width: 100% !important;
            text-align: left;
        }
        button {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            background-color: #3b4cca;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .error {
            color: #e3350d;
            background-color: #fdd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .history-list {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .guess-card {
            background-color: rgba(255, 255, 255, 0.92);
            padding: 15px;
            border: 2px solid #333;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .guess-property {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex-basis: 0;
            flex-grow: 1;
            padding: 5px;
        }
        .property-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: #666;
            margin-bottom: 4px;
            text-transform: uppercase;
            white-space: nowrap;
        }
        .property-value {
            padding: 8px;
            border-radius: 5px;
            font-weight: 600;
            width: 100%;
            white-space: nowrap;
        }
        .correct { background-color: #c8e6c9; color: #256029; }
        .wrong { background-color: #ffcdd2; color: #c63737; }

        .higher,
        .lower {
            background-color: #ffcdd2;
            color: #c63737;
        }

        .higher::after,
        .lower::after {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-left: 8px;
            vertical-align: middle;
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
        }

        .higher::after {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23c63737' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 19V5M5 12l7-7 7 7'/%3E%3C/svg%3E");
        }

        .lower::after {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23c63737' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 5v14M19 12l-7 7-7-7'/%3E%3C/svg%3E");
        }

        .win-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background-color: #c8e6c9;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #333;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .win-message p {
            font-size: 1.5em;
            color: #256029;
            font-weight: bold;
            margin: 0;
        }
        .win-pokemon-image {
            width: 200px;
            height: 200px;
            object-fit: contain;
            animation: fadeInUp 0.6s ease-out;
        }
        .pokemon-image {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .history-list .guess-card:first-child .guess-property {
            opacity: 0;
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .history-list .guess-card:first-child .guess-property:nth-child(2) { animation-delay: 0.5s; }
        .history-list .guess-card:first-child .guess-property:nth-child(3) { animation-delay: 1.0s; }
        .history-list .guess-card:first-child .guess-property:nth-child(4) { animation-delay: 1.5s; }
        .history-list .guess-card:first-child .guess-property:nth-child(5) { animation-delay: 2.0s; }
        .history-list .guess-card:first-child .guess-property:nth-child(6) { animation-delay: 2.5s; }
        .history-list .guess-card:first-child .guess-property:nth-child(7) { animation-delay: 3.0s; }
        .history-list .guess-card:first-child .guess-property:nth-child(8) { animation-delay: 3.5s; }
        .history-list .guess-card:first-child .guess-property:nth-child(9) { animation-delay: 4.0s; }

        .pokemon-select-sprite {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            vertical-align: middle;
            object-fit: contain;
        }
        .pokemon-select-option {
            display: flex;
            align-items: center;
        }

        footer {
            margin-top: 40px;
            text-align: center;
        }

        footer p {
            font-weight: bold;
            color: #000000;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.9);
        }
    </style>
</head>
<body>

<div class="main-container">
    <h1><img th:src="@{/pokedle-logo-pokemons.webp}" alt="Pokedle Logo" class="pokedle-logo"/></h1>
    <p>Adivinhe o Pokémon do dia!</p>

    <form th:action="@{/guess}" method="post" class="guess-form" th:if="${history == null or history.isEmpty() or history[0].nome.status != 'correct'}">
        <select id="pokemon-select" name="pokemonName" required>
            <option value="" disabled selected></option> 
            <option th:each="pokemon : ${pokemonList}"
                    th:value="${pokemon.name.toLowerCase()}"
                    th:text="${pokemon.name}"
                    th:data-image="${pokemon.imageUrl}"></option>
        </select>
    </form>

    <div th:if="${error}" class="error">
        <p th:text="${error}"></p>
    </div>

</div>

<div class="history-list" th:if="${history != null and !history.isEmpty()}">
    <div th:if="${history[0].nome.status == 'correct'}" class="win-message">
        <img th:src="${history[0].imagem.valor}" alt="Pokémon Correto" class="win-pokemon-image"/>
        <p th:text="'Você acertou! O Pokémon do dia era ' + ${history[0].nome.valor} + '!'"></p>
    </div>

    <div th:each="guess : ${history}" class="guess-card">
            <div class="guess-property">
                <img th:if="${guess.imagem != null and guess.imagem.valor != null}" th:src="${guess.imagem.valor}" alt="Imagem do Pokémon" class="pokemon-image"/>
            </div>
            <div class="guess-property">
                <span class="property-label">Nome</span>
                <span class="property-value" th:classappend="${guess.nome.status}" th:text="${guess.nome.valor}"></span>
            </div>
            <div class="guess-property">
                <span class="property-label">Tipo 1</span>
                <span class="property-value" th:classappend="${guess.tipo1.status}" th:text="${guess.tipo1.valor}"></span>
            </div>
            <div class="guess-property">
                <span class="property-label">Tipo 2</span>
                <span class="property-value" th:classappend="${guess.tipo2.status}" th:text="${guess.tipo2.valor}"></span>
            </div>
            <div class="guess-property">
                <span class="property-label">Peso</span>
                <span class="property-value" th:classappend="${guess.peso.status}" th:text="${guess.peso.valor}"></span>
            </div>
            <div class="guess-property">
                <span class="property-label">Altura</span>
                <span class="property-value" th:classappend="${guess.altura.status}" th:text="${guess.altura.valor}"></span>
            </div>
            <div class="guess-property">
                <span class="property-label">Cor</span>
                <span class="property-value" th:classappend="${guess.cor.status}" th:text="${guess.cor.valor}"></span>
            </div>
            <div class="guess-property">
                <span class="property-label">Habitat</span>
                <span class="property-value" th:classappend="${guess.habitat.status}" th:text="${guess.habitat.valor}"></span>
            </div>
            <div class="guess-property">
                <span class="property-label">Fase</span>
                <span class="property-value" th:classappend="${guess.fase.status}" th:text="${guess.fase.valor}"></span>
            </div>
    </div>
</div>

<footer>
    <p>Github.com/douglasAVsantos/pokedle</p>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
    $(document).ready(function() {
        function formatPokemonWithImage(pokemon) {
            if (!pokemon.id) {
                return pokemon.text;
            }
            var imageUrl = $(pokemon.element).data('image');
            if (!imageUrl) {
                return pokemon.text;
            }
            var $container = $(
                '<span class="pokemon-select-option">' +
                '<img src="' + imageUrl + '" class="pokemon-select-sprite" />' +
                '<span>' + pokemon.text + '</span>' +
                '</span>'
            );
            return $container;
        }

        $('#pokemon-select').select2({
            placeholder: "Selecione um Pokémon",
            theme: "bootstrap-5", // Aplica um tema mais moderno
            templateResult: formatPokemonWithImage,
            templateSelection: formatPokemonWithImage,
            escapeMarkup: function(markup) { return markup; }
        });

        $('#pokemon-select').on('change', function() {
            $(this).closest('form').submit();
        });
    });
</script>
</body>
</html>